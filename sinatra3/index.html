<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Sinatra 3</title>
  <meta name="viewport" content="width=device-width">
  <!-- Twitter bootstrap basic styles -->
  <link rel="stylesheet" href="/bootstrap/css/bootstrap.css">
  <link rel="stylesheet" href="/bootstrap/css/bootstrap-responsive.css">

  <!-- syntax highlighting CSS -->
  <link rel="stylesheet" href="/css/syntax.css">
  <!-- Google webfont link -->
<link href='http://fonts.googleapis.com/css?family=Arvo:700|Titillium+Web:900' rel='stylesheet' type='text/css'>


  <!-- Custom CSS -->
  <link rel="stylesheet" href="/css/main.css">

  <script src="/assets/jquery-1.10.0.js"></script>

  <script type="text/javascript" src='/bootstrap/js/bootstrap.js'></script>
  <script type="text/javascript" src='/assets/custom.js'></script>

</head>
<body class="">

  <div class="container">

    <div class="page-header">
  <h1>Sinatra 3 <small></small></h1>
</div>

<div class="tabbable tabs-left">
<ul class="nav nav-tabs" id="myTab">
	
		
		<li class="active"><a href="#0_info_gathering" data-toggle="tab">Individual profiles </a></li>
		
	
		
		<li><a href="#1_layout_files" data-toggle="tab">Sinatra layouts </a></li>
		
	
		
		<li><a href="#2_displaying_lists" data-toggle="tab">Lists of data </a></li>
		
	
		
		<li><a href="#3_project" data-toggle="tab">Project </a></li>
		
	
</ul>

<div class="tab-content">

	
	<div class="tab-pane active" id="0_info_gathering">
	

		<h2>Individual profiles</h2>
		<p>The project at the end of today&#8217;s class will be to create a sinatra app to display the group&#8217;s profile information. Before we start please take a moment to provide your information:</p>
<div class='exercise alert alert-info'><strong>
<p>Task:</p>
</strong>
<p>Please fill in <a href='https://docs.google.com/forms/d/11jxNYdOnBDXfTzHROgt-sp0r1bNltHqYEGnLuho-iQU/viewform'>this Google form</a>.</p>
</div>
	</div>

	
	<div class="tab-pane " id="1_layout_files">
	

		<h2>Sinatra layouts</h2>
		<p>One of the most important principles in software engineering is <a href='http://en.wikipedia.org/wiki/Don&apos;t_repeat_yourself'>DRY</a>: <strong>don&#8217;t repeat yourself</strong>.</p>

<p>The basic idea is that you don&#8217;t want to be copying and pasting the same code into multiple places. If you&#8217;re doing this, you&#8217;re making a lot of work for yourself should you ever decide to change that code.</p>

<p>One way that we&#8217;ve already met of staying DRY is writing functions: if there&#8217;s a task that you do repeatedly, write a function to put the logic for that task in one place and then call the function when you need to do the task.</p>

<p>Another way, that we&#8217;ll be looking at today, is in the form of layouts.</p>

<h3 id='the_problem'>The Problem</h3>

<p>So far you&#8217;ve been writing a lot of erb view templates. Here are some examples:</p>
<div class='highlight'><pre><code class='html'><span class='c'>&lt;!-- in views/index.erb --&gt;</span>
<span class='cp'>&lt;!DOCTYPE html&gt;</span>
<span class='nt'>&lt;html&gt;</span>
<span class='nt'>&lt;head&gt;</span>
    <span class='nt'>&lt;title&gt;</span>Greetings<span class='nt'>&lt;/title&gt;</span>
    <span class='c'>&lt;!-- Latest compiled and minified CSS --&gt;</span>
    <span class='nt'>&lt;link</span> <span class='na'>rel=</span><span class='s'>&quot;stylesheet&quot;</span> <span class='na'>href=</span><span class='s'>&quot;//netdna.bootstrapcdn.com/bootstrap/3.0.0-rc1/css/bootstrap.min.css&quot;</span><span class='nt'>&gt;</span>
<span class='nt'>&lt;/head&gt;</span>
<span class='nt'>&lt;body&gt;</span>
    <span class='nt'>&lt;div</span> <span class='na'>class=</span><span class='s'>&#39;container&#39;</span><span class='nt'>&gt;</span>
        <span class='nt'>&lt;h1&gt;</span>Hello everyone!<span class='nt'>&lt;/h1&gt;</span>
    <span class='nt'>&lt;/div&gt;</span>
<span class='nt'>&lt;/body&gt;</span>
<span class='nt'>&lt;/html&gt;</span>
</code></pre></div><div class='highlight'><pre><code class='html'><span class='c'>&lt;!-- in views/greet.erb --&gt;</span>
<span class='cp'>&lt;!DOCTYPE html&gt;</span>
<span class='nt'>&lt;html&gt;</span>
<span class='nt'>&lt;head&gt;</span>
    <span class='nt'>&lt;title&gt;</span>Greetings<span class='nt'>&lt;/title&gt;</span>
    <span class='c'>&lt;!-- Latest compiled and minified CSS --&gt;</span>
    <span class='nt'>&lt;link</span> <span class='na'>rel=</span><span class='s'>&quot;stylesheet&quot;</span> <span class='na'>href=</span><span class='s'>&quot;//netdna.bootstrapcdn.com/bootstrap/3.0.0-rc1/css/bootstrap.min.css&quot;</span><span class='nt'>&gt;</span>
<span class='nt'>&lt;/head&gt;</span>
<span class='nt'>&lt;body&gt;</span>
    <span class='nt'>&lt;div</span> <span class='na'>class=</span><span class='s'>&#39;container&#39;</span><span class='nt'>&gt;</span>
        <span class='nt'>&lt;h1&gt;</span>Hello <span class='err'>&lt;</span>%= @name %&gt;!<span class='nt'>&lt;/h1&gt;</span>
    <span class='nt'>&lt;/div&gt;</span>
<span class='nt'>&lt;/body&gt;</span>
<span class='nt'>&lt;/html&gt;</span>
</code></pre></div>
<p>Notice that these files are almost the same - a lot of copy and paste has gone on.</p>

<h3 id='the_solution'>Â The solution</h3>

<p>Sinatra gets round this problem by allowing you to have a <code>layout.erb</code> file in your <code>views</code> folder:</p>
<div class='highlight'><pre><code class='html'><span class='c'>&lt;!-- views/layout.erb --&gt;</span>
<span class='cp'>&lt;!DOCTYPE html&gt;</span>
<span class='nt'>&lt;html&gt;</span>
<span class='nt'>&lt;head&gt;</span>
    <span class='nt'>&lt;title&gt;</span>Greetings<span class='nt'>&lt;/title&gt;</span>
    <span class='c'>&lt;!-- Latest compiled and minified CSS --&gt;</span>
    <span class='nt'>&lt;link</span> <span class='na'>rel=</span><span class='s'>&quot;stylesheet&quot;</span> <span class='na'>href=</span><span class='s'>&quot;//netdna.bootstrapcdn.com/bootstrap/3.0.0-rc1/css/bootstrap.min.css&quot;</span><span class='nt'>&gt;</span>
<span class='nt'>&lt;/head&gt;</span>
<span class='nt'>&lt;body&gt;</span>
    <span class='nt'>&lt;div</span> <span class='na'>class=</span><span class='s'>&#39;container&#39;</span><span class='nt'>&gt;</span>
        <span class='err'>&lt;</span>%= yield %&gt;
    <span class='nt'>&lt;/div&gt;</span>
<span class='nt'>&lt;/body&gt;</span>
<span class='nt'>&lt;/html&gt;</span>
</code></pre></div>
<p>You can then write only the bits that change in the other two views:</p>
<div class='highlight'><pre><code class='html'><span class='c'>&lt;!-- in views/index.erb --&gt;</span>
<span class='nt'>&lt;h1&gt;</span>Hello everyone!<span class='nt'>&lt;/h1&gt;</span>
</code></pre></div><div class='highlight'><pre><code class='html'><span class='c'>&lt;!-- in views/greet.erb --&gt;</span>
<span class='nt'>&lt;h1&gt;</span>Hello <span class='err'>&lt;</span>%= @name %&gt;!<span class='nt'>&lt;/h1&gt;</span>
</code></pre></div>
<p>Sinatra knows that if you have a file called <code>layout.erb</code> it should use that as a layout. If you call <code>erb :index</code>:</p>

<ul>
<li>It takes the <code>layout.erb</code> file.</li>

<li>It finds the bit where it says <code>&lt;%= yield %&gt;</code>.</li>

<li>It inserts <code>index.erb</code> at that point.</li>
</ul>

<p>You can find more about Sinatra layouts on <a href='http://lmgtfy.com/?q=sinatra+layouts'>the internet</a>.</p>
	</div>

	
	<div class="tab-pane " id="2_displaying_lists">
	

		<h2>Lists of data</h2>
		<p>So far we have only inserted single values and words into an already existing <code>erb</code> template. We will now look at using ruby to generate more of the template dynamically.</p>

<p>Suppose you have a ruby array that you want to turn into an html list:</p>
<div class='highlight'><pre><code class='ruby'><span class='c1'># in app.rb</span>

<span class='n'>get</span> <span class='s1'>&#39;/fruit&#39;</span> <span class='k'>do</span>
  <span class='vi'>@fruits</span> <span class='o'>=</span> <span class='o'>[</span><span class='s2'>&quot;Bananas&quot;</span><span class='p'>,</span> <span class='s2'>&quot;Apples&quot;</span><span class='p'>,</span> <span class='s2'>&quot;Raspberries&quot;</span><span class='o'>]</span>
  <span class='n'>erb</span> <span class='ss'>:fruits_view</span>
<span class='k'>end</span>
</code></pre></div>
<p>We can do this by using the <code>@fruits</code> array&#8217;s <code>each</code> method to interate over the elements and put them into the page one-by-one.</p>
<div class='highlight'><pre><code class='html'><span class='c'>&lt;!-- in views/fruits_view.erb --&gt;</span>
<span class='nt'>&lt;ul&gt;</span>
    <span class='err'>&lt;</span>% @fruits.each do |fruit| %&gt;
        <span class='nt'>&lt;li&gt;</span><span class='err'>&lt;</span>%= fruit %&gt;<span class='nt'>&lt;/li&gt;</span>
    <span class='err'>&lt;</span>% end %&gt;
<span class='nt'>&lt;/ul&gt;</span>
</code></pre></div>
<p>You might notice that we&#8217;ve used a different type of erb tag for the <code>do ... end</code> block: <code>&lt;% %&gt;</code> instead of <code>&lt;%= %&gt;</code>. This is really important:</p>

<ul>
<li>You need to use <code>&lt;%= %&gt;</code> if you want the result of executing that line of ruby to be added to the page.</li>

<li>You need to use <code>&lt;% %&gt;</code> if you don&#8217;t want the result of executing that line of ruby to be added to the page.</li>
</ul>

<p>Here, the bits we want adding are the elements of the array, so only they have the <code>&lt;%= %&gt;</code> tags. The code will cause the following html to be generated:</p>
<div class='highlight'><pre><code class='html'><span class='nt'>&lt;ul&gt;</span>
    <span class='nt'>&lt;li&gt;</span>Bananas<span class='nt'>&lt;/li&gt;</span>
    <span class='nt'>&lt;li&gt;</span>Apples<span class='nt'>&lt;/li&gt;</span>
    <span class='nt'>&lt;li&gt;</span>Raspberries<span class='nt'>&lt;/li&gt;</span>
<span class='nt'>&lt;/ul&gt;</span>
</code></pre></div>
<p>You can also use the same technique to generate tables and other html (lists of divs etc.).</p>
<div class='exercise alert alert-info'><strong>
<p>Task:</p>
</strong>
<ol>
<li>
<p>Clone the code for this exercise:</p>

<pre><code> $ git clone https://github.com/code61/sinatra2.git</code></pre>

<p>Your aim for this exercise is to create the following <a href='http://code61-list-all-things.herokuapp.com/'>example site</a>.</p>
</li>

<li>
<p>Have a look in <code>views/fruits_view.erb</code> and <code>app.rb</code> to check you understand what&#8217;s going on.</p>
</li>

<li>
<p>Add some code to <code>views/oldest_dogs_view.erb</code> to create a list of dogs.</p>
</li>

<li>
<p>Add some code to <code>views/countries_view.erb</code> to create a <em>table</em> of countries and their capitals.</p>
</li>

<li>
<p>Add some code to <code>views/simpsons_view.erb</code> to create the Simpsons page like <a href='http://code61-list-all-things.herokuapp.com/simpsons'>the example</a>.</p>
</li>

<li>
<p>(Optional extension) see if you can set up the individual pages dedicated to each Simpson e.g <a href='http://code61-list-all-things.herokuapp.com/simpsons/bart'>Bart&#8217;s page</a>. You will need a new routing block in <code>app.rb</code>, a new erb template in <code>views</code> and to think about how you will indentify the Simpson you want from the url.</p>
</li>
</ol>
</div>
	</div>

	
	<div class="tab-pane " id="3_project">
	

		<h2>Project</h2>
		<p>The aim of this project is to create a course profiles site, similar to <a href='http://cfg-profiles.herokuapp.com/'>this one</a>.</p>
<div class='exercise alert alert-info'><strong>
<p>Task:</p>
</strong>
<ol>
<li>Fork the project at <a href='https://github.com/code61/sinatra_project3'>https://github.com/code61/sinatra_project3</a>.</li>

<li>Clone your fork down onto your laptop.</li>

<li>You will need to work out how to read in the data from a CSV file. Take a look at the <a href='/ruby3'>ruby 3</a> session, or search for something like &#8220;ruby read csv&#8221;.</li>

<li>Create a list of all the course members at the root url <code>/</code>.</li>

<li>Create a page for each member. You will need to decide which property of the user to put in the url, that you will later use to look them up. Link to these pages from the list you made in stap 4.</li>
</ol>
</div>
	</div>

</div>

</div>




  </div> <!-- /container -->

</body>
</html>
